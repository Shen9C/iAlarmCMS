<form id="searchForm" method="GET" action="{{ url_for('alarm_view.index') }}">
    <!-- 添加隐藏的 user_token 字段 -->
    <input type="hidden" name="user_token" value="{{ request.args.get('user_token') }}">
    <!-- ... 其他表单字段 ... -->
</form>

<!-- 修改状态列的显示 -->
<td>
    {% if not alarm.is_confirmed %}
        <button type="button" class="btn btn-sm btn-primary confirm-btn" data-bs-toggle="modal" data-bs-target="#confirmModal" data-alarm-id="{{ alarm.id }}">确认</button>
    {% else %}
        {% if alarm.confirm_type == 'fault' %}
            <span class="badge bg-danger">故障</span>
        {% elif alarm.confirm_type == 'false_alarm' %}
            <span class="badge bg-warning">误报</span>
        {% else %}
            <span class="badge bg-success">已确认</span>
        {% endif %}
    {% endif %}
</td>

<!-- 添加确认模态框 -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">确认告警</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>请选择确认类型：</p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="confirmType" id="typeFault" value="fault" checked>
                    <label class="form-check-label" for="typeFault">故障</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="confirmType" id="typeFalseAlarm" value="false_alarm">
                    <label class="form-check-label" for="typeFalseAlarm">误报</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirmSubmit">确认</button>
            </div>
        </div>
    </div>
</div>

<!-- 在页面底部，确保在引入 alarms.js 之前添加这段代码 -->
{% block extra_js %}
<script>
$(document).ready(function() {
    // 确认按钮点击事件
    $(document).on('click', '.confirm-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('Button clicked');
        var modal = new bootstrap.Modal(document.getElementById('confirmModal'));
        modal.show();
    });
});
</script>
{% endblock %}